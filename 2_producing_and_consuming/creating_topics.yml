version: '3.8'
services:
  zoo1:
    hostname: zoo1
    container_name: zoo1
    extends:
      service: zoo
      file: shared/kafka.yml
  kafka1:
    hostname: kafka1
    container_name: kafka1
    extends:
      service: kafka
      file: shared/kafka.yml
    depends_on:
      - zoo1


  webui:
    extends:
      service: kafka-ui
      file: ../shared/kafka.yml

  init:
    container_name: init-kafka
    extends:
      service: kafka-cli
      file: ../shared/kafka.yml
    command: |
      "
      # blocks until kafka is reachable
      kafka-topics --bootstrap-server ${KAFKA_BROKER} --list
      
      echo -e 'Creating kafka topics'
      kafka-topics --bootstrap-server ${KAFKA_BROKER} --create --if-not-exists --topic my-topic-1 --replication-factor 1 --partitions 1
      echo -e 'Created following topics:'
      kafka-topics --bootstrap-server ${KAFKA_BROKER} --list
      
      "
  consumer:
    container_name: kafka-consumer
    extends:
      service: kafka-cli
      file: ../shared/kafka.yml
    depends_on:
      init:
        condition: service_completed_successfully
    command: |
      "
      kafka-console-consumer --bootstrap-server ${KAFKA_BROKER} --topic my-topic-1 --property "print.key=true"
      "
